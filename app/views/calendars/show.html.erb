<h1>Overview of "<%= h @calendar.name %>" Guide</h1>

<b>Location:</b>
<span>
  <% if @full_access %>
  <a class="view-area" href="javascript:" onclick="calendar.editGuideLocation(this.parentNode);" title="click to edit"> <%= h @calendar.location.name %> </a>
  <span class="edit-area hidden" style="position:relative;">
    <input type="text" value="<%= @calendar.location.name %>" class="location-input"/><span style="position:absolute;left:50%;" class="location-loading"></span>
    <a href="javascript:" onclick="calendar.resetGuideLocation(this.parentNode.parentNode);">[cancel]</a>
  </span>
  <span class="hidden">
    <% form_tag(update_guide_path(:id => @calendar), :method => 'post', :class => 'submit-location') do %>
        <input type="hidden" name="location_name" class="param_location_name">
        <input type="hidden" name="location_code" class="param_location_code">
    <% end %>
  </span>
  <% else %>
    <%= h @calendar.location.name %>
  <% end %>
</span>

<br/>
<b> Times Viewed:</b>
<%= h @calendar.view_count %>
<b> | Times Clicked:</b>
<%= h @calendar.click_count %>

<p>
</p>
<div align="right">
  <a href="/calendars/<%= @calendar.id %>/share" class="textflow">view live version and get script</a>
</div>     <BR><BR>

<div id="view_tips">

  <table width="100%" border="1" cellpadding="0" cellspacing="0">

    <tr>
      <th></th>
      <% @weekdays.each do |day| %>
          <th>
            <div style="padding:10px">
            <%= day.name %>
            <% if @full_access %>
                <br/>
                <a href="/guides/<%= @calendar.id %>/edit#<%= day.name %>">edit</a>
            <% end %>
            </div>
          </th>
      <% end %>
    </tr>

    <% prev_cond = Condition.new %>
    <% @conditions.each do |condition| %>

        <!-- horizontal labels for 'day', 'dinner' and 'nigthlife' -->
        <% if condition.group != prev_cond.group %>
            <tr>
              <td class="headtext" colspan="20" align="center" style="background-color:#6666ff;">
                <%= condition.group %>
              </td>
            </tr>
        <% end %>
        <% prev_cond = condition %>

        <tr>

          <td>
            <!--left labels-->
            <div style="padding:10px">
            <%= condition.weather ? condition.weather : '' %> <%= condition.name %>
            <% if @full_access %>
                <br/>
                <a href="/guides/<%= @calendar.id %>/edit#<%= condition.name %>">edit</a>
            <% end %>
            </div>
          </td>

          <% @weekdays.each do |day| %>
              <% place = @calendar.show_places.detect { |t| t.condition.id == condition.id and t.weekday.id == day.id } %>
              <% tip = place == nil ? nil : place.tip %>

              <td valign="top" class="tip-container" condition_id="<%= condition.id %>" day_id="<%= day.id %>">
                <% if tip != nil then %>
                    <%= render :partial => 'tips/show_tile', :locals => {:place => place} %>
                <% else %>
                    <%= render :partial => 'tips/no_tip_tile', :locals => {:condition => condition, :day => day} %>
                <% end %>
              </td>


          <% end %>
        </tr>
    <% end %>

  </table>



</div>


<BR><BR>
<div align="right">
  <a href="/guides/<%= @calendar.id %>/share" class="textflow">view live version and get script</a>
</div>


<div id="new_tip" style="display:none;">
  <% form_tag("/guides/#{@calendar.id}/tips/create", :method => "post", :id => 'new_tip_form') do %>
      <input id="new_tip_name" name="new_tip_name"/>
  <% end %>
</div>


<script type="text/javascript">
  $(document).ready(function() {
      // initialize autocomplete for locations
      $('.location-input').each(function(i, e) {
          calendar.locationInput(e, function(input, result) {
              if (result == null) {
                  return;
              }
              var root = input.parent().parent();
              root.find('.view-area').html(result.label);
              calendar.resetGuideLocation(root);

              // Now save value.
              common.setLoading($('.location-loading'), 'Saving...');
              root.find('.param_location_name').val(result.label);
              root.find('.param_location_code').val(result.id);
              root.find('.submit-location').ajaxSubmit({
                  success: function() {
                      common.stopLoading($('.location-loading'));
                  }
              });
          });
      });
  });
</script>